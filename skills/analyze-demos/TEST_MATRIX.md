# 测试验证矩阵

## 1. 正常触发测试

| 测试用例 | 输入 | 预期行为 | 验证点 |
|----------|------|----------|--------|
| 基础触发 | `/analyze-demos` | 处理所有未完成记录 | 无中断询问，一次性完成 |
| 限量触发 | `/analyze-demos 3` | 只处理前3条 | 正确限制处理数量 |
| 语义触发 | "帮我分析这个Demo表格" | 自动识别并执行 | 技能正确激活 |
| 无待处理 | 所有记录已完成 | 返回"所有记录已完成" | 不报错，正常结束 |

## 2. 边缘情况测试

### 2.1 输入数据异常

| 测试用例 | 模拟条件 | 预期行为 | 验证点 |
|----------|----------|----------|--------|
| 无预览文件 | 预览文件字段为空 | 仅用Prompt描述分析 | 不中断，正常生成 |
| 预览文件获取失败 | 文件URL过期 | 回退到纯文本分析 | 记录日志，继续处理 |
| Prompt描述过短 | "做个游戏" | 使用默认值填充 | 场景默认"一句话造游戏" |
| 特殊字符 | Prompt含emoji/换行 | 正常处理 | 不影响JSON解析 |

### 2.2 API 异常

| 测试用例 | 模拟条件 | 预期行为 | 验证点 |
|----------|----------|----------|--------|
| Gemini超时 | 网络延迟>60s | 重试3次后跳过 | 记录失败，继续下一条 |
| Gemini限流 | 429响应 | 等待5秒后重试 | 自动恢复 |
| 飞书Token过期 | 401响应 | 刷新Token重试 | 自动恢复 |
| 飞书写入失败 | 500响应 | 记录错误，继续 | 不中断流程 |

### 2.3 响应解析异常

| 测试用例 | 模拟条件 | 预期行为 | 验证点 |
|----------|----------|----------|--------|
| 非JSON响应 | Gemini返回纯文本 | 正则提取关键信息 | 尽可能解析 |
| 字段缺失 | 响应缺少某字段 | 使用默认值 | 不中断 |
| 无效场景名 | 返回不在列表中的场景 | 使用"一句话生成App" | 默认值生效 |
| 评分越界 | 返回分数>100 | 截断为100 | 数据校验生效 |

## 3. 干扰排除测试

| 测试用例 | 输入 | 预期行为 | 验证点 |
|----------|------|----------|--------|
| 相似但不触发 | "什么是Demo分析？" | 不触发技能 | 纯问答不激活 |
| 其他表格 | "分析销售数据表格" | 不触发技能 | 场景边界正确 |
| 手动编辑请求 | "帮我改一下这条记录" | 不触发技能 | 非批量操作不激活 |

## 4. 静默执行验证

### 必须验证的行为

| 检查项 | 通过标准 |
|--------|----------|
| 无确认询问 | 执行过程中不出现"是否继续"类问题 |
| 无中途停顿 | 不因单条记录问题而暂停整个流程 |
| 批量完成 | 所有记录处理完毕后才输出结果 |
| 自动重试 | 失败记录自动重试，不询问用户 |
| 默认值应用 | 缺失数据自动使用预设默认值 |

### Anti-Pattern 检测

执行后检查输出是否包含以下**禁止出现**的内容：

```
❌ "是否需要我继续？"
❌ "请确认是否处理"
❌ "需要更多信息"
❌ "请问要处理哪些记录？"
❌ "遇到问题，是否重试？"
```

## 5. 性能基准

| 指标 | 目标值 | 说明 |
|------|--------|------|
| 单条处理时间 | < 30秒 | 4次Gemini调用 + 1次飞书写入 |
| 批量10条 | < 5分钟 | 包含重试时间 |
| 重试成功率 | > 80% | 临时性错误应能恢复 |

## 6. 测试执行清单

```
□ 准备测试数据：创建5条空白记录
□ 测试基础触发：/analyze-demos
□ 验证无中断执行
□ 检查飞书数据正确写入
□ 模拟API超时，验证重试机制
□ 验证失败汇总报告格式
□ 清理测试数据
```

## 7. 回归测试场景

当修改提示词文件后，需重新验证：

| 修改内容 | 需验证 |
|----------|--------|
| 场景分类.md | 场景分类准确性 |
| 能力识别.md | 能力标签合理性 |
| 创意生成.md | 标题/描述/标签格式 |
| 评分标准.md | 评分分布合理性 |
